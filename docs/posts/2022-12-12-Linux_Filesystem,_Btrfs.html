<!doctype html>
<html lang="id">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- Favicon -->
        <link rel="apple-touch-icon" sizes="180x180" href="https://aerphanas.github.io/images/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="https://aerphanas.github.io/images/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="194x194" href="https://aerphanas.github.io/images/favicon-194x194.png">
        <link rel="icon" type="image/png" sizes="192x192" href="https://aerphanas.github.io/images/android-chrome-192x192.png">
        <link rel="icon" type="image/png" sizes="16x16" href="https://aerphanas.github.io/images/favicon-16x16.png">
        <link rel="manifest" href="https://aerphanas.github.io/images/site.webmanifest">
        <link rel="mask-icon" href="https://aerphanas.github.io/images/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="msapplication-TileColor" content="#74dfcd">
        <meta name="msapplication-TileImage" content="https://aerphanas.github.io/images/mstile-144x144.png">
        <meta name="theme-color" content="#ffffff">
        
        <!-- Search engine verification -->
        <meta name="google-site-verification" content="PtVSsNbHUZiIKmCTl_XmAhpsKNuaQynBo3s6NcvA4IA" />
        <meta name="yandex-verification" content="23d78fa93441542e" />
        <meta name="msvalidate.01" content="D584132B529EC5AF6250A7305A706FA0" />

        <!-- Open Graph / Facebook -->
        <meta property="og:title" content="Λerphanas Blog - Linux Filesystem, Btrfs" />
        <meta property="og:url" content="https://aerphanas.github.io/posts/2022-12-12-Linux_Filesystem%2C_Btrfs.html" />
        <meta property="og:image" content="https://aerphanas.github.io/images/logo.png" />
        <meta property="og:description" content="sebuah filesystem yang menggunakan teknologi COW atau copy on write dan fokus ke toleransi kesalahan, perbaikan dan administrasi yang mudah." />
        <meta property="og:locale" content="id_ID" />
        <meta property="og:site_name" content="Λerphanas" />
        <meta property="og:type" content="website" />

        <!-- Twitter -->
        <meta name="twitter:title" content="Λerphanas Blog - Linux Filesystem, Btrfs" />
        <!--<meta name="twitter:url" content="https://aerphanas.github.io" />-->
        <meta name="twitter:image" content="https://aerphanas.github.io/images/logo.png" />
        <meta name="twitter:description" content="sebuah filesystem yang menggunakan teknologi COW atau copy on write dan fokus ke toleransi kesalahan, perbaikan dan administrasi yang mudah." />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:site" content="@aerphanas" />
        <meta name="twitter:creator" content="@aerphanas" />

        <link rel="stylesheet" href="https://aerphanas.github.io/css/default.css" />
        <script src="https://kit.fontawesome.com/f96722f9f5.js" crossorigin="anonymous"></script>
        <title>Λerphanas Blog - Linux Filesystem, Btrfs</title>
        <meta name="title" content="Λerphanas Blog - Linux Filesystem, Btrfs" />
        <meta name="description" content="sebuah filesystem yang menggunakan teknologi COW atau copy on write dan fokus ke toleransi kesalahan, perbaikan dan administrasi yang mudah." />
        <meta name="author" content="aerphanas">
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="https://aerphanas.github.io"><i class="fa-solid fa-temperature-full"></i> Λerphanas</a>
            </div>
            <nav>
                <a href="https://aerphanas.github.io/etc/about.html"><i class="fa-regular fa-address-card"></i> Tentang</a>
                <a href="https://aerphanas.github.io/archive.html"><i class="fa-regular fa-file-zipper"></i> Arsip</a>
                <a href="https://github.com/aerphanas?tab=repositories" target="_blank"><i class="fa-solid fa-code"></i> Proyek</a>
            </nav>
        </header>

        <main role="main">
            <h1>Linux Filesystem, Btrfs </h1>
            
            <article>
    <section class="header">
        diposting pada Dec 12, 2022

        
            oleh aerphanas
         <br><br>
        <a href="https://twitter.com/share?url=https://aerphanas.github.io/posts/2022-12-12-Linux_Filesystem%2C_Btrfs.html&text=Linux Filesystem, Btrfs&via=aerphanas" target="_blank">
            <i class="fa-brands fa-twitter fa-xl"></i>
        </a>
        <!-- Facebook (url) -->
        <a href="https://www.facebook.com/sharer/sharer.php?u=https://aerphanas.github.io/posts/2022-12-12-Linux_Filesystem%2C_Btrfs.html" target="_blank">
            <i class="fa-brands fa-facebook fa-xl"></i>
        </a>
        <!-- Reddit (url, title) -->
        <a href="https://reddit.com/submit?url=https://aerphanas.github.io/posts/2022-12-12-Linux_Filesystem%2C_Btrfs.html&title=Linux Filesystem, Btrfs" target="_blank">
            <i class="fa-brands fa-reddit fa-xl"></i>
        </a>
        <!-- Hacker News (url, title) -->
        <a href="https://news.ycombinator.com/submitlink?u=https://aerphanas.github.io/posts/2022-12-12-Linux_Filesystem%2C_Btrfs.html&t=Linux Filesystem, Btrfs" target="_blank">
            <i class="fa-brands fa-hacker-news fa-xl"></i>
        </a>
        <!-- LinkedIn (url, title, summary, source url) -->
        <a href="https://www.linkedin.com/shareArticle?url=https://aerphanas.github.io/posts/2022-12-12-Linux_Filesystem%2C_Btrfs.html&title=Linux Filesystem, Btrfs&summary=sebuah filesystem yang menggunakan teknologi COW atau copy on write dan fokus ke toleransi kesalahan, perbaikan dan administrasi yang mudah." target="_blank">
            <i class="fa-brands fa-linkedin fa-xl"></i>
        </a>
        <!-- Email (subject, body) -->
        <a href="mailto:?subject=Linux Filesystem, Btrfs&body=https://aerphanas.github.io/posts/2022-12-12-Linux_Filesystem%2C_Btrfs.html">
            <i class="fa-solid fa-envelope fa-xl"></i>
        </a>
        <a href="https://wa.me/?text=https://aerphanas.github.io/posts/2022-12-12-Linux_Filesystem%2C_Btrfs.html" target="_blank">
            <i class="fa-brands fa-square-whatsapp fa-xl"></i>
        </a>
    </section>
    <section>
        <h2 id="daftar-isi">Daftar isi</h2>
<ul>
<li><a href="#pendahuluan">Pendahuluan</a></li>
<li><a href="#fitur">Fitur</a></li>
<li><a href="#cara-membuat-partisi">Cara Membuat Partisi</a>
<ul>
<li><a href="#sub-volume">Sub Volume</a></li>
<li><a href="#snapshots">Snapshots</a></li>
</ul></li>
<li><a href="#daftar-pustaka">Daftar Pustaka</a></li>
</ul>
<h2 id="pendahuluan">Pendahuluan</h2>
<hr />
<p>btrfs merupakan sebuah filesystem moderen yang menggunakan teknologi copy on write, yang artinya bila kita melakukan perubahan pada folder atau file maka file/folder itu akan menjadi 2, yang pertama adalah sebelum diubah dan yang kedua adalah yang sudah terubah, maka bila terjadi kesalahan kita bisa melakukan roll-back atau kembali ke keadaan awal.</p>
<h2 id="sejarah">Sejarah</h2>
<hr />
<p>btrfs pertama kali di desain oleh perusahaan oracle untuk mengatasi masalah kurangnya fitur yang ada pada linux filesystem, yaitu snapshots, checksum dan volume managemen pada tahun 2007, barulah pada tahun 2013 btrfs memasuki fase stabil.</p>
<h2 id="fitur">Fitur</h2>
<hr />
<p>btrfs memiliki beberapa fitur utamanya adalah :</p>
<ul>
<li>COW atau dalam kata lain Snapshots tidak membuat duplikat secara penuh, melainkan hanyalan menympan perubahan yang terjadi.</li>
<li>terdapat managemen volume yang menggunakan software dengan support untuk RAID 0, RAID 1, RAID 10 and yang lainnya.</li>
<li>otomatis menmebenahi diri sendiri dengan ckecksoum dan metadata, dan otomatis mendeteksi data yang korup.</li>
</ul>
<h2 id="cara-membuat-partisi">Cara Membuat Partisi</h2>
<hr />
<p>saya akan memberitahukan bagai mana cara konfigurasi btrfs dengan benar sehingga kita dapat mendapatkan performa yang sempurna.</p>
<p>hampir sama seperti <a href="https://aerphanas.github.io/posts/2022-12-08-Linux_Filesystem%2C_keluarga_extfs.html#cara-membuat-partisi">cara saya membuat partisi ext4</a>, kita perlu beberapa penyesuaian yaitu :</p>
<p>daripada <code>mkfs.ext4</code> kita harus <code>mkfs.btrfs</code>, sebelum menjalankan perintah itu kita harus menginstall <code>btrfs-progs</code>.</p>
<p>setelah membuat partisi kita harus membuat sebuah subvolume, agar dengan mudan mengelola snapshots, tidak ada dasar peraturan dalam membuat sub volume namun kita bisa mencontohnya pada distro OpenSUSE, seperti inilah fstabnya:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/mapper/cr_system-opensuse</span>             /            btrfs  defaults,ssd          0  0</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/mapper/cr_system-opensuse</span>             /var         btrfs  subvol=/@/var         0  0</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/mapper/cr_system-opensuse</span>             /usr/local   btrfs  subvol=/@/usr/local   0  0</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/mapper/cr_system-opensuse</span>             /tmp         btrfs  subvol=/@/tmp         0  0</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/mapper/cr_system-opensuse</span>             /srv         btrfs  subvol=/@/srv         0  0</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/mapper/cr_system-opensuse</span>             /root        btrfs  subvol=/@/root        0  0</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/mapper/cr_system-opensuse</span>             /opt         btrfs  subvol=/@/opt         0  0</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/mapper/cr_system-opensuse</span>             /home        btrfs  subvol=/@/home        0  0</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/mapper/cr_system-opensuse</span>             /.snapshots  btrfs  subvol=/@/.snapshots  0  0</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">/dev/system/swap</span>                           swap         swap   defaults              0  0</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a> <span class="va">UUID</span><span class="op">=</span>3efcee78-2bc1-4311-9e0a-8105eabfea36 <span class="ex">/home/adivin</span> ext4   defaults              0  0</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a> <span class="va">UUID</span><span class="op">=</span>012d1240-27ce-4a72-bc08-986536624f49 <span class="ex">/boot</span>        ext4   data=ordered          0  2</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a> <span class="va">UUID</span><span class="op">=</span>0B96-B7E3                            <span class="ex">/boot/efi</span>    vfat   utf8                  0  2</span></code></pre></div>
<p>setelah kita membuat sebuah partisi, kita harus memasang partisinya ke dalam sebuah folder :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">mkdir</span> /root/disk <span class="co"># membuat folder disk</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">mount</span> /dev/sda1 /root/disk <span class="co"># pasang drive sda1 ke folder disk</span></span></code></pre></div>
<p>setelah berhasil memasang partisi ke folder <code>/root/disk</code>, kita harus membuat sebuah folder <code>@</code> lalu membuat sub volume disana.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">mkdir</span> /root/disk/@</span></code></pre></div>
<h3 id="sub-volume">Sub Volume</h3>
<p>melihat contoh fstab OpenSUSE kita bisa simpulkan bahwa kita memerlukan beberapa sub volume yaitu :</p>
<ol type="1">
<li>/var</li>
<li>/usr/local</li>
<li>/tmp</li>
<li>/srv</li>
<li>/root</li>
<li>/opt</li>
<li>/home</li>
</ol>
<p>sub volume bisa dibuat dengan cara :</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume create <span class="op">&lt;</span>volume yang mau dibuat<span class="op">&gt;</span></span></code></pre></div>
<p>maka kita bisa membuat sub volume seperti opensuse dengan cara :</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">mkdir</span> /root/disk/@/usr <span class="co"># membuat folder untuk local sub volume</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume create /root/disk/@/var</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume create /root/disk/@/usr/local</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume create /root/disk/@/tmp</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume create /root/disk/@/srv</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume create /root/disk/@/root</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume create /root/disk/@/opt</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume create /root/disk/@/home</span></code></pre></div>
<p>untuk menghapus subvolume kita bisa menghapusnya dengan :</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume delete /root/disk/@/var</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume delete /root/disk/@/usr/local</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume delete /root/disk/@/tmp</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume delete /root/disk/@/srv</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume delete /root/disk/@/root</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume delete /root/disk/@/opt</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume delete /root/disk/@/home</span></code></pre></div>
<p>untuk melihat list apasaja subvolume yang ada bisa dengan komand :</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume list /root/disk/@</span></code></pre></div>
<p>kita bisa memasang subvolume dengan :</p>
<p>kita bisa menggunakan subvolid atau menggunakan tempat dimana subvol dibuat, untuk mendapatkan subvolid kita bisa melihatnya dengan</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume show /root/disk/@/var</span></code></pre></div>
<p>bila sudah mendapatkan subvolid kita bisa memasangnya di <code>/root/disk/var</code> dengan perintah seperti berikut, namun bila folder <code>/root/disk/var</code> tidak ada kita harus membuatnya dengan secara manual</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">mount</span> /dev/sdb1 <span class="at">-o</span> subvolid=261 /root/disk/var</span></code></pre></div>
<p>atau menggunakan tempat dimana subvol dibuat</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">mount</span> /dev/sdb1 <span class="at">-o</span> subvol=/root/disk/@/var /root/disk/var</span></code></pre></div>
<h3 id="snapshots">Snapshots</h3>
<p>setelah membuat sub volume jita bisa mudah mengelola snapshot, untuk membuat snapshot kita bisa menggunakan software timeshift atau snapper, namun kita juga bisa membuat snapshot secara manual, bila kita menggunakan timesift atau snapper otomatis akan membuat subvolume/folder .snapshots pada partisi.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume create /root/disk/@/.snapshots <span class="co"># membuat subvolume untuk menampung snapshots</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume snapshot /root/disk /root/disk/.snapshots/yy-mm-dd-backup <span class="co"># membuat snapshots RW bernama yy-mm-dd-backup</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume snapshot <span class="at">-r</span> /root/disk /root/disk/.snapshots/yy-mm-dd-backup <span class="co"># membuat snapshots RO bernama yy-mm-dd-backup</span></span></code></pre></div>
<p>untuk menghapus snpashot kita bisa menggunakan komand :</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">btrfs</span> subvolume delete /root/disk/.snapshots/yy-mm-dd-backup</span></code></pre></div>
<p>setelah kita membuat snapshot, kita bisa mengembalikan keadaan folder dengan cara manual menggunakan komand <code>cp</code> atau <code>rsync</code> untuk mengembalikan keseluruhanya.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">rsync</span> <span class="at">-avz</span> /root/disk /root/disk/.snapshots/yy-mm-dd-backup /root/disk</span></code></pre></div>
<p>untuk mengupdate snapshot sama caranya untuk mengembalikan keadaan folder/file, yaitu dengan komand <code>cp</code> atau <code>rsync</code></p>
<h2 id="daftar-pustaka">Daftar Pustaka</h2>
<hr />
<ul>
<li><p>Wikipedia<br />
↪ <a href="https://en.wikipedia.org/wiki/Btrfs">Btrfs</a><br />
↪ <a href="https://en.wikipedia.org/wiki/Copy-on-write">Copy On Write</a></p></li>
<li><p>Btrfs Wiki<br />
↪ <a href="https://btrfs.wiki.kernel.org/index.php/Main_Page">Btrfs Wiki Main Pages</a></p></li>
<li><p>Btrfs Read The Docs<br />
↪ <a href="https://btrfs.readthedocs.io/en/latest/index.html">BTRFS documentation</a></p></li>
<li><p>Linux Hint<br />
↪ <a href="https://linuxhint.com/create-mount-btrfs-subvolumes/">How to Create and Mount Btrfs Subvolumes</a><br />
↪ <a href="https://linuxhint.com/use-btrfs-snapshots/">How to Use Btrfs Snapshots</a></p></li>
</ul>
    </section>
</article>
<br>
<details open>
    <summary>Comments</summary>
    <script src="https://utteranc.es/client.js" repo="aerphanas/aerphanas.github.io" issue-term="title" label="issues created by Utterances. " theme="github-light" crossorigin="anonymous" async>
</script>
</details>
<br>


        </main>

        <footer>
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" class="license">
                <img alt="Creative Commons License" style="border-width:0" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" />
            </a>
            Dibuat Dengan <i class="fa-solid fa-heart fa-beat"></i> + 
            <a href="http://jaspervdj.be/hakyll" class="make">Hakyll</a>
        </footer>
    </body>
</html>
